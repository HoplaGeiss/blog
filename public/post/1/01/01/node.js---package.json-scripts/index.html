


<main class="content" role="main">
	<article class="post">
		<div class="inner">

			<div id="push">

  			<header class="post-header">
  				<span class="post-meta">
						<span class="post-date">1 Jan 0001</span> <span class="reading-time">| <span class="estimated-reading-time">3 min.</span> (<span class="word-count">449</span> words)</span></span>
  				</span>
  				<div class="clear"></div>
  				<h1 class="post-title">Node.js - Package.json scripts</h1>
  			</header>

  			<section class="post-content">
  				

<p>If you are developing an angular application, chances are you are using @angular/cli. It is a fantastic tools which comes packed with awesome time saving features. Now recently I had to work on a node.js backend project and I dearly missed @angular/cli, so this post is about a couple tricks I found to mock @angular/cli&rsquo;s features.</p>

<h1 id="ng-test:db53ee46823194ad4a153b2985305dd9">ng test</h1>

<p>Usually angular unit test are along side the file they refer to, in node sadly most of the time it is not the case. You have a bit of set up to do configure jasmine to work in this way. Also with <code>ng test</code> karma implements a watchers that triggers the test every time a file changes, this is extremely useful in a TDD approach.</p>

<p>Goals:
- Have the test files side by side with the source files.
- Have a watcher to reload the test every time a file changes.</p>

<p>1- Install jasmine and nodemon</p>

<p><code>npm install jasmine nodemon --save-dev</code></p>

<p>We will use nodemon to watch for file changes and jasmine as development framework.</p>

<p>2- configure jasmine</p>

<p>spec/support/jasmine.json</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">{</span>
  <span style="color: #f92672">&quot;spec_dir&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #f92672">&quot;spec_files&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[</span>
    <span style="color: #e6db74">&quot;services/**/*.spec.js&quot;</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">&quot;controllers/**/*.spec.js&quot;</span>
  <span style="color: #f8f8f2">],</span>
  <span style="color: #f92672">&quot;stopSpecOnExpectationFailure&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span>
  <span style="color: #f92672">&quot;random&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #66d9ef">false</span>
<span style="color: #f8f8f2">}</span>
</pre></div>

<p>3- Configure scripts in package.json</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">{</span>
  <span style="color: #f92672">&quot;scripts&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f92672">&quot;test&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;./node_modules/nodemon/bin/nodemon.js --exec ./node_modules/jasmine/bin/jasmine.js&quot;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>

<h1 id="ng-test-code-coverage:db53ee46823194ad4a153b2985305dd9">ng test &ndash;code-coverage</h1>

<p>Running the test and generating the coverage report with istanbul is another awesome feature of @angular/cli. To implement this we just need to install istanbul have set it up!</p>

<p>1- Install istanbul
<code>npm install istanbul --save-dev</code></p>

<p>2- configure istanbul</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e"># .istanbul.yml</span>
<span style="color: #ae81ff">instrumentation</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">include-all-sources</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
  <span style="color: #ae81ff">verbose</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
  <span style="color: #ae81ff">excludes</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;**/*.spec.js&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #ae81ff">reporting</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">dir</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;coverage&quot;</span>
</pre></div>

<p>Two very important settings here that I struggled to find:
- <code>include-all-sources</code>: this makes sure all the files are included in the report, not just only the one loaded by the spec files.
- <code>excludes</code>: this removes the spec files from the report.</p>

<p>3- Configure scripts in package.json</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">{</span>
  <span style="color: #f92672">&quot;scripts&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f92672">&quot;coverage&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;node_modules/istanbul/lib/cli.js cover node_modules/jasmine/bin/jasmine.js&quot;</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>

<p>Note: the only difference with @angular/cli is there will be a couple more files in the coverage folder, I didn&rsquo;t find out how to crack this, but I guess it works alright like this.</p>

<h1 id="ng-lint:db53ee46823194ad4a153b2985305dd9">ng lint</h1>

<p>Linters are fabulous to keep high coding standard in your project. Lets see how to make them available through npm.</p>

<p>1- Install eslint</p>

<p><code>npm install eslint --save-dev</code></p>

<p>2- Tweak the configuration file</p>

<p>I advise you to take a look online at the documentation to find all the rules and configuration you can use with linters. There is no point me posting my linters in here as this settings are specific to each developer/teams.
Anyhow make sure you have an eslint configuration at the root folder</p>

<p>3- Configure scripts in package.json</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">{</span>
  <span style="color: #f92672">&quot;scripts&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f92672">&quot;lint&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;node_modules/.bin/eslint **/*.js&quot;</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>

  			</section>

  			<footer class="post-footer">
  				<div class="post-tags">
            
  				</div>
  				
  			</footer>

  			<aside class="post-comments">
    
    
    <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    
</aside>


			</div>

			<nav class="post-nav">
				
					<a class="post-nav-item post-nav-next" href="http://www.muller.tech/post/2016/12/22/unit-test-removal-of-a-class/">
						<section class="post-nav-teaser">
							<span class="post-nav-icon"><i class="icon-arrow-left"></i></span>
							<span class="post-nav-info">
								<h4 class="post-nav-title">Unit test the removal of a class</h4>
								<p class="post-nav-excerpt">Step by step description of how to unit test the removal of a class&hellip;</p>
							</span>
						</section>
					</a>
				
				
				<div class="clear"></div>
			</nav>

		</div>
	</article>
</main>

<div id="body-class" style="display: none;"></div>
<footer id="footer">
	<section class="credits">
		
	</section>

	<div id="sig" style="position: absolute; font-family: Helvetica, Verdana, Arial, Sans-Serif; font-size: 12px; color: #999999; bottom: 0; left: calc(50% - 145px);">
	  <div style="position: relative; display: inline-block;">
	    <span style="line-height: 30px;">
	      <div style="display: inline-block; float: left;">
	        <span style="font-weight: bold;">Gabriel Muller</span> - Front End Developer |
	      </div>

	      <a target="_blank" href="https://uk.linkedin.com/in/mullergab" style="position: relative;display: inline-block; text-decoration:none; float: left">
	        <img src="http://www.muller.tech/images/linkedin.png" alt="linkedin" style="width: 20px; padding: 5px 10px; margin:0" />
	      </a>
	      <span style="float: left"> | </span>
	      <a target="_blank" href="https://github.com/hoplageiss" style="position: relative;display: inline-block; text-decoration:none; float: left">
	        <img src="http://www.muller.tech/images/github.png" alt="github" style="width: 20px; padding: 5px 10px; margin:0"/>
	      </a>
	    </span>
	  </div>
	</div>
</footer>


<div id="tocMenu" data-target="toc">
    <div class="menu-header">
        <span class="menu-label">Menu</span>
        <a class="menu-close" data-action="toc" data-target="toc"></a>
    </div>
    <div id="toc" class="menu-list">
        <nav id="TableOfContents">
<ul>
<li><a href="#ng-test:db53ee46823194ad4a153b2985305dd9">ng test</a></li>
<li><a href="#ng-test-code-coverage:db53ee46823194ad4a153b2985305dd9">ng test &ndash;code-coverage</a></li>
<li><a href="#ng-lint:db53ee46823194ad4a153b2985305dd9">ng lint</a></li>
</ul>
</nav>
    </div>
</div>


<div class="overlay"></div>
</div>
</section>

<script async src="/js/main.js"></script>



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-69583716-1', 'auto');
ga('send', 'pageview');
</script>




<noscript><link rel="stylesheet" href="/css/main.css"></noscript>
</body>
</html>

