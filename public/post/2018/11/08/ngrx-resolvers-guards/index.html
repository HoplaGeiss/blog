
<!DOCTYPE html>
<html lang="en-gb">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" Ngrx Guards and Resolvers &middot;  Gabriel Muller - JavaScript and Angular articles" />
        <meta property="og:site_name" content="Gabriel Muller - JavaScript and Angular articles" />
        <meta property="og:url" content="http://www.muller.tech/post/2018/11/08/ngrx-resolvers-guards/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2018-11-08T00:00:00Z" />
        <meta property="og:article:tag" content="angular5" />
        <meta property="og:article:tag" content="ngrx" />
        <meta property="og:article:tag" content="guards" />
        <meta property="og:article:tag" content="resolvers" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="Ngrx Guards and Resolvers" />
        <meta name="twitter:description" content="When using ngrx, why is everyone implementing guards to load data instead of resolvers?" />
        <meta name="twitter:url" content="http://www.muller.tech/post/2018/11/08/ngrx-resolvers-guards/" />
    

        <title> Ngrx Guards and Resolvers &middot;  Gabriel Muller - JavaScript and Angular articles</title>

        <link rel="preload" href="/js/main.js" as="script" />
        <link rel="preload" href="/css/main.css" as="style" />

    
        <meta name="description" content="When using ngrx, why is everyone implementing guards to load data instead of resolvers?" />
    

    
        <meta name="p:domain_verify" content=""/>
    

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
        

    
        <link href="http://www.muller.tech/index.xml" rel="alternate" type="application/rss+xml" title="Gabriel Muller - JavaScript and Angular articles" />
    

    
        <link rel="canonical" href="http://www.muller.tech/post/2018/11/08/ngrx-resolvers-guards/" />


    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://www.muller.tech/post/2018/11/08/ngrx-resolvers-guards/"
        },
        "headline": "Ngrx Guards and Resolvers",
        "description": "When using ngrx, why is everyone implementing guards to load data instead of resolvers?",
        "author": {
            "@type": "Person",
            "name": "Gabriel Muller",
            "url": "http://profiles.google.com/?rel=author",
            "image": {
              "@type": "ImageObject",
              "url": "https:",
              "height": 80,
              "width": 80
            }
        },
        "publisher": {
          "@type": "Organization",
          "@id": "http://www.muller.tech/",
          "name": "Gabriel Muller - JavaScript and Angular articles",
          "url": "http://www.muller.tech/",
          "logo": {
            "@type": "ImageObject",
            "url": "https:",
            "height": 80,
            "width": 80
          }
        },
        "image": {
          "@type": "ImageObject",
          "url": "http://www.muller.tech/images/data.png",
          "height": 133,
          "width": 200
        },
        "datePublished": "2018-11-08",
        "dateModified": "2018-11-08",
        "wordCount": 937,
        "keywords": ["angular5","ngrx","guards","resolvers"]
    }
    </script>


    
    <script type="text/javascript">
    
    
      var disqus_shortname = 'mullertech';
      var disqus_identifier = 'http:\/\/www.muller.tech\/post\/2018\/11\/08\/ngrx-resolvers-guards\/';
      var disqus_title = 'Ngrx Guards and Resolvers';
      var disqus_url = 'http:\/\/www.muller.tech\/post\/2018\/11\/08\/ngrx-resolvers-guards\/';
    
    </script>
    

    <style>
html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,figure,footer,header,main,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:300;src:local("Merriweather Sans Light"),local(MerriweatherSans-Light),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowY_zIojJi0m4a5Z6tRh6itY.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:400;src:local("Merriweather Sans Regular"),local(MerriweatherSans-Regular),url(//fonts.gstatic.com/s/merriweathersans/v5/AKu1CjQ4qnV8MUltkAX3sL2aU247V0zTzydO4RoO9Ok.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:700;src:local("Merriweather Sans Bold"),local(MerriweatherSans-Bold),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowQfd-b-I5PxxcmB4_-MNcqw.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:normal;font-weight:800;src:local("Merriweather Sans ExtraBold"),local(MerriweatherSans-ExtraBold),url(//fonts.gstatic.com/s/merriweathersans/v5/6LmGj5dOJopQKEkt88GowWT7sFQ1Iz1BbpcuCPlgc9Q.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:300;src:local("Merriweather Sans Light Italic"),local(MerriweatherSans-LightItalic),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVX9UU5BmOJGkLxUCVv5VXdc.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:400;src:local("Merriweather Sans Italic"),local(MerriweatherSans-Italic),url(//fonts.gstatic.com/s/merriweathersans/v5/3Mz4hOHzs2npRMG3B1ascf0KIgDhPIHb_R-SWdtqte8.woff) format("woff")}@font-face{font-family:'Merriweather Sans';font-style:italic;font-weight:700;src:local("Merriweather Sans Bold Italic"),local(MerriweatherSans-BoldItalic),url(//fonts.gstatic.com/s/merriweathersans/v5/nAqt4hiqwq3tzCecpgPmVYM8pfYvjMoOxygpzLVILAs.woff) format("woff")}@font-face{font-family:'icons';src:url(/fonts/icons.eot?9273991);src:url(/fonts/icons.eot?9273991#iefix) format("embedded-opentype"),url(/fonts/icons.woff?9273991) format("woff"),url(/fonts/icons.ttf?9273991) format("truetype"),url(/fonts/icons.svg?9273991#icons) format("svg");font-weight:400;font-style:normal}[class^="icon-"]:before{font-family:"icons";font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-arrow-right:before{content:'\e807'}.icon-rss:before{content:'\e808'}body{font:300 1em / 1.5em 'Merriweather Sans',sans-serif;color:#595B66}a{color:inherit;text-decoration:none;font-weight:400}h1,h2{text-rendering:optimizeLegibility;color:#1F2026}h2 a{font-weight:inherit}h1{font-size:2em;line-height:1em;margin:2em 0 -.5em}h2{font-size:1.75em;line-height:1.143em;margin:2.286em 0 -.571em}p{margin:2em auto}i{font-weight:400;font-style:italic;color:#363740}img{display:block;max-width:100%;height:auto;margin:2.5em auto}body{background:#fff}.inner{max-width:48em;margin:0 auto;padding:0 1em}#wrapper{position:relative;box-sizing:border-box;width:100%;min-height:100vh;padding-bottom:6em;background:#F2F3F5}#push{transform:translate3d(0,0,0);transform-style:preserve-3d;opacity:1}#nav{position:relative;background:#fff;z-index:70;transform:translate3d(0,0,0);transform-style:preserve-3d;opacity:1}#nav:after{clear:both;content:'';display:table}#nav .nav-logo{float:left;height:2em;padding:1em;max-width:50%}#nav .nav-logo img{width:auto;max-width:none;height:2em;margin:0;border-radius:5px}#nav .nav-menu{float:right}#nav .nav-menu:after{clear:both;content:'';display:table}#nav .nav-menu a{display:block;width:1em;height:1em;line-height:1em;padding:1.5em;text-align:center;float:left}#nav .nav-menu a i:before{margin:auto}.overlay{display:none;position:fixed;left:0;top:0;width:100%;height:100%;z-index:80;display:none}.overlay:before{content:'';position:absolute;left:0;top:0;width:100%;height:100%;background:#1F2026;opacity:0;transform-style:preserve-3d}#header{position:relative;padding:4em 0}#header .inner{position:relative;z-index:2}#header .header-title{display:block;text-align:center}#header .header-name{font-weight:700;letter-spacing:-1px;display:block;line-height:1em;font-size:2em;text-decoration:none;color:#1F2026;padding:0;margin:0}#header.has-cover .header-name{color:#fff}#header .header-description{display:block;margin:1em auto 0;color:#9D9FA6;position:relative;font-weight:300}#header .header-description:after{content:'';position:absolute;height:1px;width:100px;margin-left:-50px;left:50%;top:-.5em;background:#D4D5D9}#header.has-cover .header-description{color:#fff}#header.has-cover .header-description:after{background:#fff}#header .header-cover{position:absolute;width:100%;height:100%;top:0;left:0;margin-top:-4em;padding:4em 0;background:no-repeat fixed center 100% / cover;z-index:1}#header .header-cover:before{content:'';position:absolute;width:100%;height:100%;left:0;top:0;background:rgba(0,0,0,0.2)}#header .header-cover:after{content:'';position:absolute;width:100%;left:0;bottom:0;border-bottom:4px solid #36D995}#footer{position:absolute;width:100%;left:0;bottom:0;font-size:.75em;line-height:1.334em;background:#1F2026;color:#737580;z-index:20;transform:translate3d(0,0,0);transform-style:preserve-3d;opacity:1}#footer a{color:#9D9FA6;font-weight:400}#footer .credits{text-align:center;font-size:.75em;line-height:1.334em;padding:2.667em;overflow:auto}#footer .credits span{display:block}#footer .credits .credits-theme{float:left}#footer .credits .credits-software{float:right}.post{position:relative;z-index:20}.post .post-image{display:block;margin:0;padding:0}.post .post-image img{display:block;width:100%;height:auto;margin:0;padding:0}.post .post-meta{display:block;font-size:.75em;line-height:1.334em;font-weight:400;margin-bottom:1.334em}.post .post-title{position:relative;color:#000;font-size:2em;line-height:1.375em;font-weight:800;text-indent:-1px;margin:.25em 0 .75em}.post .post-title:before{content:'';position:absolute;left:0;bottom:-.334em;width:1em;margin-bottom:-2px;border-bottom:4px solid #36D995}.post .post-title a{text-decoration:none;color:inherit;font-weight:inherit}#post-index{position:relative;max-width:1200px;margin:0 auto 4em;padding:.5em;z-index:10}@keyframes fade{0%{transform:translate3d(0,3em,0);opacity:0}100%{transform:translate3d(0,0,0);opacity:1}}.post-list{position:relative}.post-list .post{float:left;width:33.3%;transform:translate3d(0,3em,0);transform-style:preserve-3d;opacity:0;animation:fade ease-out .5s forwards;animation-delay:1.4s}@media only screen and (max-width: 50em){.post-list .post{width:49.9%}}@media only screen and (max-width: 30em){.post-list .post{width:100%;float:none}}.post-list .post:nth-child(1){animation-delay:.1s}.post-list .post:nth-child(2){animation-delay:.2s}.post-list .post:nth-child(3){animation-delay:.3s}.post-list .post:nth-child(4){animation-delay:.4s}.post-list .post:nth-child(5){animation-delay:.5s}.post-list .post:nth-child(6){animation-delay:.6s}.post-list .post:nth-child(7){animation-delay:.7s}.post-list .post:nth-child(8){animation-delay:.8s}.post-list .post:nth-child(9){animation-delay:.9s}.post-list .post .inner{padding:2em;margin:.5em;max-width:none;background:#fff;box-sizing:border-box;transform:scale(1);transform-style:preserve-3d}@media only screen and (max-width: 50em){.post-list .post .inner{padding:1em}}.post-list .post .post-link{position:absolute;left:0;top:0;width:100%;height:100%;z-index:10}.post-list .post .post-image{position:relative;margin:-2em -2em 0;overflow:hidden;background:#36D995}@media only screen and (max-width: 50em){.post-list .post .post-image{margin:-1em -1em 0}}.post-list .post .post-image img{transform:scale(1);transform-style:preserve-3d;opacity:1}.post-list .post .post-image:after{content:'';position:absolute;left:-5%;bottom:-2.5em;width:110%;height:4em;background:#fff;border-top:4px solid #36D995;box-shadow:0 0 2em rgba(0,0,0,0.2);transform:rotate(5deg)}.post-list .post .post-title{font-size:1.5em;line-height:1.167em}.post-list .post .post-excerpt{margin:0}.post-list .post .post-more{display:block;margin-top:1.5em}.post-list .post .post-more a{display:inline-block;font-size:.875em;line-height:1.143em;font-weight:400;color:#363740}.post-list .post .post-more a i{color:#2DB77E}.pagination{min-height:3em;margin:4em auto 2em;padding:0;position:relative}.pagination .pagination-item{position:relative;display:block;height:3em;line-height:3em;padding:0 1em;text-align:center;text-decoration:none;font-weight:700;color:#363740;border:1px solid #36D995;border-radius:4em;z-index:60}.pagination .pagination-item i{position:relative}@media only screen and (max-width: 30em){.pagination .pagination-item{width:4em;height:4em;line-height:4em;margin-top:-.5em;padding:0!important}.pagination .pagination-item i{font-size:1.5em}.pagination .pagination-item>span{display:none}}.pagination .pagination-prev{float:right}.pagination .pagination-prev i{right:-.05em}.pagination .pagination-info{display:block;left:0;top:0;height:3em;line-height:3em;position:absolute;text-align:center;width:100%;z-index:50;color:#9D9FA6}#loader-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000}#loader{display:block;position:relative;left:50%;top:50%;width:150px;height:150px;margin:-75px 0 0 -75px;border-radius:50%;border:3px solid transparent;border-top-color:#36D995;animation:spin 2s linear infinite}#loader:before{content:"";position:absolute;top:5px;left:5px;right:5px;bottom:5px;border-radius:50%;border:3px solid transparent;border-top-color:#2DB77E;animation:spin 3s linear infinite}#loader:after{content:"";position:absolute;top:15px;left:15px;right:15px;bottom:15px;border-radius:50%;border:3px solid transparent;border-top-color:#D4D5D9;animation:spin 1.5s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
</style>


    </head>
    <body class="home-template">
      <div id="loader-wrapper">
        <div id="loader"></div>
      </div>
      <section id="wrapper" style="display: none;">
        <div id="ajax-container">
          <nav id="nav" class="nav">
            <div class="nav-logo">
              <a href="http://www.muller.tech/">
      			  
      			  	<img src="/images/logo.png" alt="Logo"/>
      			  
              </a>
            </div>
            <div class="nav-menu">
              <a class="rss" href="">
                <i class="icon-rss"></i>
              </a>
                
                <a class="menu" data-action="toc" data-target="toc"><i class="icon-location"></i></a>
                
                
            </div>
          </nav>


<main class="content" role="main">
	<article class="post">
		<div class="inner">

			<div id="push">

  			<header class="post-header">
  				<span class="post-meta">
						<span class="post-date">8 Nov 2018</span> <span class="reading-time">| <span class="estimated-reading-time">5 min.</span> (<span class="word-count">937</span> words)</span></span>
  				</span>
  				<div class="clear"></div>
  				<h1 class="post-title">Ngrx Guards and Resolvers</h1>
  			</header>

  			<section class="post-content">
  				

<p>In this post, we will have a look at an example of an ngrx application using guards and resolvers. Based on this, we will see when guards and resolvers are best using with ngrx.</p>

<p>Personally, I find one of the main advantages of using ngrx is to handle data in a more efficient way, e.g. not re-loading the data when it&rsquo;s already in state.</p>

<p>All the example I found online while learning about ngrx were using guards, and I didn&rsquo;t quite understand why that was. When you look at the documentation of guards and resolver on angular&rsquo;s doc, it clearly states that:</p>

<ul>
<li>Guards should be used to block the navigation if certain conditions are not met; think protected route like the transition between a landing page and logged-in page or viewer mode and admin mode.</li>
<li>Resolvers should be used to load data before a page is initialized so that the data is available for the user to use.</li>
</ul>

<p>So after reading that I went ahead and tried to implement my next feature using a resolver, that didn&rsquo;t go so well for me, you will see why in a bit. Now let&rsquo;s get started and implement our little ngrx application.</p>

<p>Our application is an online library and the data we are playing with are books and authors.
Books are loaded with a gaurd and authors are loaded with a resolver.</p>

<p>If you are in a hurry, you can check out the source code here: <a href="https://github.com/HoplaGeiss/hopla-resolver-guard">https://github.com/HoplaGeiss/hopla-resolver-guard</a></p>

<p>Let&rsquo;s dive in!</p>

<h3 id="routing-file">Routing file</h3>

<p>Let&rsquo;s start off with our routing file. As you can see books are protected by a guard and authors are loaded with a resolver.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// library.routing.ts
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">AuthorsResolver</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./resolvers/authors.resolver&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">BooksGuard</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./guards/books.guard&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">NgModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">RouterModule</span>, <span style="color:#a6e22e">Routes</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/router&#39;</span>;

<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">LibraryComponent</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./containers/library.component&#39;</span>;

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">routes</span>: <span style="color:#66d9ef">Routes</span> <span style="color:#f92672">=</span> [
  {
    <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
    <span style="color:#a6e22e">canActivate</span><span style="color:#f92672">:</span> [ <span style="color:#a6e22e">BooksGuard</span> ],
    <span style="color:#a6e22e">resolve</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">authors</span>: <span style="color:#66d9ef">AuthorsResolver</span> },
    <span style="color:#a6e22e">component</span>: <span style="color:#66d9ef">LibraryComponent</span>
  }
];

<span style="color:#66d9ef">@NgModule</span>({
  <span style="color:#a6e22e">imports</span><span style="color:#f92672">:</span> [
    <span style="color:#a6e22e">RouterModule</span>.<span style="color:#a6e22e">forChild</span>(<span style="color:#a6e22e">routes</span>)
  ],
})

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LibraryRouting</span> {}</code></pre></div>
<h3 id="book-guard">Book guard</h3>

<p>Our book guard is a classic guard using ngrx state. I am consecutively calling:</p>

<ul>
<li>The selector <code>getBooksLoaded</code> to see if the books are loaded.</li>
<li>If they are not loaded I dispatch <code>LoadBooks</code> to load them.</li>
<li>Then I have a <code>filter</code> to make sure I only go forward if the books are loaded</li>
<li>Finally, I have <code>take</code> to stop the subscription.</li>
<li>Also, I have a <code>catchError</code> that returns an observable of false to say the guard can&rsquo;t pass.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">CanActivate</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/router&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Store</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@ngrx/store&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Observable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs/Observable&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">of</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs/observable/of&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">catchError</span>, <span style="color:#a6e22e">filter</span>, <span style="color:#a6e22e">take</span>, <span style="color:#a6e22e">tap</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs/operators&#39;</span>;

<span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">fromStore</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../store&#39;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BooksGuard</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">CanActivate</span> {
  <span style="color:#66d9ef">constructor</span>(
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">store</span>: <span style="color:#66d9ef">Store</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">any</span><span style="color:#f92672">&gt;</span>
  ) {}

  <span style="color:#a6e22e">canActivate</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">Observable</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">boolean</span><span style="color:#f92672">&gt;</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">fromStore</span>.<span style="color:#a6e22e">getBooksLoaded</span>).<span style="color:#a6e22e">pipe</span>(
      <span style="color:#a6e22e">tap</span>(<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">=&gt;</span> {
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">loaded</span>) <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">dispatch</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">fromStore</span>.<span style="color:#a6e22e">LoadBooks</span>());
      }),
      <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">loaded</span>),
      <span style="color:#a6e22e">take</span>(<span style="color:#ae81ff">1</span>),
      <span style="color:#a6e22e">catchError</span>(() <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">of</span>(<span style="color:#66d9ef">false</span>))
    );
  }
}</code></pre></div>
<h3 id="author-resolver">Author resolver</h3>

<p>Since I didn&rsquo;t find any example of resolver using ngrx online, I pretty much created this on my own based on guards.
As you can see the first part is identical to the guard, the only difference is at the end. Instead of returning an observable of true or false I am actually returning the data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Resolve</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/router&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">select</span>, <span style="color:#a6e22e">Store</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@ngrx/store&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Observable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs/Observable&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">filter</span>, <span style="color:#a6e22e">switchMap</span>, <span style="color:#a6e22e">take</span>, <span style="color:#a6e22e">tap</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs/operators&#39;</span>;

<span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">fromStore</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../store&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Author</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./../models/author.model&#39;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AuthorsResolver</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">Resolve</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Author</span>[]<span style="color:#f92672">&gt;</span> {
  <span style="color:#66d9ef">constructor</span>(
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">store</span>: <span style="color:#66d9ef">Store</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">any</span><span style="color:#f92672">&gt;</span>
  ) { }

  <span style="color:#a6e22e">resolve</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">Observable</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Author</span>[]<span style="color:#f92672">&gt;</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">fromStore</span>.<span style="color:#a6e22e">getAuthorsLoaded</span>).<span style="color:#a6e22e">pipe</span>(
      <span style="color:#a6e22e">tap</span>(<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">=&gt;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">loaded</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">dispatch</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">fromStore</span>.<span style="color:#a6e22e">LoadAuthors</span>()) <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span> ),
      <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">loaded</span>),
      <span style="color:#a6e22e">take</span>(<span style="color:#ae81ff">1</span>),
      <span style="color:#a6e22e">switchMap</span>(() <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">pipe</span>(<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">fromStore</span>.<span style="color:#a6e22e">getAuthorsData</span>), <span style="color:#a6e22e">take</span>(<span style="color:#ae81ff">1</span>)))
    );
  }
}</code></pre></div>
<h3 id="container-displaying-authors-and-books">Container displaying authors and books</h3>

<p>To finish let&rsquo;s see how the books and the authors are used in my component.
The books are loaded in a classical way, by calling a selector.
However, for the authors we don&rsquo;t need to access the state, we can get them directly from the router.</p>

<p>At first, I thought that&rsquo;s an advantage as I don&rsquo;t need to import the store. However, then I realised that by doing so, I am not going to get the update to the authors from the state.
What I am doing here is loaded the authors before the page loads and passing a value to the router and that value does not update.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// library.component.ts
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Component</span>, <span style="color:#a6e22e">OnInit</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Store</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@ngrx/store&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Observable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs/Observable&#39;</span>;

<span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">fromStore</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../store&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Author</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./../models/author.model&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Book</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./../models/book.model&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ActivatedRoute</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/router&#39;</span>;

<span style="color:#66d9ef">@Component</span>({
  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;hopla-library&#39;</span>,
  <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`
</span><span style="color:#e6db74">    &lt;h1&gt;Books:&lt;/h1&gt;
</span><span style="color:#e6db74">    &lt;h3 *ngFor=&#39;let book of (books$ | async)&#39;&gt;
</span><span style="color:#e6db74">      {{ book.title }}
</span><span style="color:#e6db74">    &lt;/h3&gt;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    &lt;h1&gt;Authors:&lt;/h1&gt;
</span><span style="color:#e6db74">    &lt;h3 *ngFor=&#39;let author of authors&#39;&gt;
</span><span style="color:#e6db74">      {{ author.name }}
</span><span style="color:#e6db74">    &lt;/h3&gt;
</span><span style="color:#e6db74">  `</span>
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LibraryComponent</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">OnInit</span> {
  <span style="color:#a6e22e">books$</span>: <span style="color:#66d9ef">Observable</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Book</span>[]<span style="color:#f92672">&gt;</span>;
  <span style="color:#a6e22e">authors</span>: <span style="color:#66d9ef">Author</span>[];

  <span style="color:#66d9ef">constructor</span>(
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">store</span>: <span style="color:#66d9ef">Store</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">any</span><span style="color:#f92672">&gt;</span>,
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">route</span>: <span style="color:#66d9ef">ActivatedRoute</span>
  ) {}

  <span style="color:#a6e22e">ngOnInit() {</span>
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">books$</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">fromStore</span>.<span style="color:#a6e22e">getBooksData</span>);
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">authors</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">route</span>.<span style="color:#a6e22e">snapshot</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">authors</span>;
  }
}</code></pre></div>
<p>So here you go that&rsquo;s the trade of using resolvers instead of state:</p>

<ul>
<li>Semantically more correct, as you are trying to load data and not protect a route.</li>
<li>Gives you access to the data directly, so you don&rsquo;t need to import the state in your component.</li>
<li>It&rsquo;s a one time load. Your data does not get updated. To do so, you would need to subscribe to the state.</li>
</ul>

<p>That’s it! Have a look there for the source code: <a href="https://github.com/HoplaGeiss/hopla-resolver-guard">https://github.com/HoplaGeiss/hopla-resolver-guard</a></p>

  			</section>

  			<footer class="post-footer">
  				<div class="post-tags">
            
            
                <a href="http://www.muller.tech/tags/angular5/">angular5</a>
            
                <a href="http://www.muller.tech/tags/ngrx/">ngrx</a>
            
                <a href="http://www.muller.tech/tags/guards/">guards</a>
            
                <a href="http://www.muller.tech/tags/resolvers/">resolvers</a>
            
            
  				</div>
  				
  			</footer>

  			<aside class="post-comments">
    
    
    <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    
</aside>


			</div>

			<nav class="post-nav">
				
				
					<a class="post-nav-item post-nav-prev" href="http://www.muller.tech/post/2017/12/01/angular5-input-directive/">
						<section class="post-nav-teaser">
							<span class="post-nav-icon"><i class="icon-arrow-right"></i></span>
							<span class="post-nav-info">
								<h4 class="post-nav-title">Angular 5 - Input directive</h4>
								<p class="post-nav-excerpt">Create an input directive that highlights errors with angular 5&hellip;</p>
							</span>
						</section>
					</a>
				
				<div class="clear"></div>
			</nav>

		</div>
	</article>
</main>

<div id="body-class" style="display: none;"></div>
<footer id="footer">
	<section class="credits">
		
	</section>

	<div id="sig" style="position: absolute; font-family: Helvetica, Verdana, Arial, Sans-Serif; font-size: 12px; color: #999999; bottom: 0; left: calc(50% - 145px);">
	  <div style="position: relative; display: inline-block;">
	    <span style="line-height: 30px;">
	      <div style="display: inline-block; float: left;">
	        <span style="font-weight: bold;">Gabriel Muller</span> - Full Stack Developer |
	      </div>

	      <a target="_blank" href="https://uk.linkedin.com/in/mullergab" style="position: relative;display: inline-block; text-decoration:none; float: left">
	        <img src="http://www.muller.tech/images/linkedin.png" alt="linkedin" style="width: 20px; padding: 5px 10px; margin:0" />
	      </a>
	      <span style="float: left"> | </span>
	      <a target="_blank" href="https://github.com/hoplageiss" style="position: relative;display: inline-block; text-decoration:none; float: left">
	        <img src="http://www.muller.tech/images/github.png" alt="github" style="width: 20px; padding: 5px 10px; margin:0"/>
	      </a>
	    </span>
	  </div>
	</div>
</footer>


<div id="tocMenu" data-target="toc">
    <div class="menu-header">
        <span class="menu-label">Menu</span>
        <a class="menu-close" data-action="toc" data-target="toc"></a>
    </div>
    <div id="toc" class="menu-list">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#routing-file">Routing file</a></li>
<li><a href="#book-guard">Book guard</a></li>
<li><a href="#author-resolver">Author resolver</a></li>
<li><a href="#container-displaying-authors-and-books">Container displaying authors and books</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>


<div class="overlay"></div>
</div>
</section>

<script async src="/js/main.js"></script>



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-69583716-1', 'auto');
ga('send', 'pageview');
</script>




<noscript><link rel="stylesheet" href="/css/main.css"></noscript>
</body>
</html>

